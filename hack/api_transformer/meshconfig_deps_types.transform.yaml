outputFile: api/v1alpha1/meshconfig_deps_types.go
headerFile: common/scripts/copyright-banner-go.txt
package: v1alpha1

globalTransformations:
  removeImports:
  - github.com/golang/protobuf/ptypes/duration
  - github.com/golang/protobuf/ptypes/wrappers
  - github.com/golang/protobuf/ptypes/struct
  - google.golang.org/protobuf/types/known/wrapperspb
  - google.golang.org/protobuf/types/known/structpb
  - google.golang.org/protobuf/types/known/durationpb
  - google.golang.org/protobuf/types/known/anypb
  - google.golang.org/genproto/googleapis/api/annotations
  - google.golang.org/protobuf/reflect/protoreflect
  - google.golang.org/protobuf/runtime/protoimpl
  - reflect
  - sync
  - istio.io/api/type/v1beta1
  - istio.io/api/networking/v1alpha3
  - istio.io/api/networking/v1beta1
  addImports:
    metav1: k8s.io/apimachinery/pkg/apis/meta/v1
    k8sv1: k8s.io/api/core/v1
  removeFields:
  - "*.state"         # protobuf-specific field
  - "*.sizeCache"     # protobuf-specific field
  - "*.unknownFields" # protobuf-specific field
  removeFunctions:
  - "*.*"   # remove all functions for now (these are only getters, which we don't need (yet?))
  replaceTypes:
    "*wrappers.BoolValue": "*bool"
    "*wrappers.Int32Value": "*int32"
    "*wrappers.Int64Value": "*int64"
    "*wrappers.UInt32Value": "*uint32"
    "*duration.Duration": "*metav1.Duration"

inputFiles:
- path: /tmp/destination_rule.pb.go
  transformations:
    removeTypes:
    - '*'
    preserveTypes:
    - ConnectionPoolSettings_TCPSettings_TcpKeepalive
    - LocalityLoadBalancerSetting
    - LocalityLoadBalancerSetting_Distribute
    - LocalityLoadBalancerSetting_Failover
    - ClientTLSSettings
    - ClientTLSSettings_TLSmode

- path: /tmp/virtual_service.pb.go
  transformations:
    removeTypes:
    - '*'
    preserveTypes:
    - HTTPRetry

- path: /tmp/network.pb.go

- path: /tmp/proxy.pb.go
  transformations:
    renameTypes:
      ProxyConfig: MeshConfigProxyConfig
    replaceFieldTypes:
      RemoteService.TcpKeepalive: "*ConnectionPoolSettingsTCPSettingsTcpKeepalive"
      RemoteService.TlsSettings: "*ClientTLSSettings"
      Tracing.TlsSettings: "*ClientTLSSettings"
      ProxyConfig.ReadinessProbe: "*k8sv1.Probe"
      ProxyConfig.Image: "*ProxyImage"

- path: /tmp/proxy_config.pb.go
  transformations:
    removeTypes:
    - '*'
    preserveTypes:
    - ProxyImage
    replaceFieldTypes:
      ProxyConfig.Selector: "*WorkloadSelector"

- path: /tmp/selector.pb.go

