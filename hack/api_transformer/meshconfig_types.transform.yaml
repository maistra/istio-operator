outputFile: api/v1alpha1/meshconfig_types.go
headerFile: common/scripts/copyright-banner-go.txt
package: v1alpha1

globalTransformations:
  removeImports:
  - github.com/golang/protobuf/ptypes/duration
  - github.com/golang/protobuf/ptypes/wrappers
  - github.com/golang/protobuf/ptypes/struct
  - google.golang.org/protobuf/types/known/wrapperspb
  - google.golang.org/protobuf/types/known/structpb
  - google.golang.org/protobuf/types/known/durationpb
  - google.golang.org/protobuf/types/known/anypb
  - google.golang.org/genproto/googleapis/api/annotations
  - google.golang.org/protobuf/reflect/protoreflect
  - google.golang.org/protobuf/runtime/protoimpl
  - reflect
  - sync
  - istio.io/api/type/v1beta1
  - istio.io/api/networking/v1alpha3
  - istio.io/api/networking/v1beta1
  removeFields:
  - "*.state"         # protobuf-specific field
  - "*.sizeCache"     # protobuf-specific field
  - "*.unknownFields" # protobuf-specific field
  removeFunctions:
  - "*.*"   # remove all functions for now (these are only getters, which we don't need (yet?))
  replaceTypes:
    "*wrappers.BoolValue": "*bool"
    "*wrappers.Int32Value": "*int32"
    "*wrappers.Int64Value": "*int64"
    "*wrappers.UInt32Value": "*uint32"
    "*duration.Duration": "*metav1.Duration"

inputFiles:
- path: /tmp/config.pb.go
  transformations:
    renameImports:
      v1: metav1
    replaceFieldTypes:
      MeshConfig_ExtensionProvider_EnvoyFileAccessLogProvider_LogFormat_Labels.Labels: "map[string]string"
      MeshConfig_ExtensionProvider_EnvoyOpenTelemetryLogProvider_LogFormat.Labels: "map[string]string"
      MeshConfig.DefaultConfig: "*MeshConfigProxyConfig"
      MeshConfig.TcpKeepalive: "*ConnectionPoolSettingsTCPSettingsTcpKeepalive"
      MeshConfig.LocalityLbSetting: "*LocalityLoadBalancerSetting"
      MeshConfig.DefaultHttpRetryPolicy: "*HTTPRetry"
      ConfigSource.TlsSettings: "*ClientTLSSettings"
      MeshConfig_CA.TlsSettings: "*ClientTLSSettings"
    addTags:
      MeshConfig.ExtensionProviders: "// +kubebuilder:validation:MaxItems=1000"  # to prevent CEL cost overruns
